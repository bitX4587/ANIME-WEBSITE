<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AnimePage â€” Manga</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      /* â”€â”€ Manga card (matches anime-card feel from style.css) â”€â”€ */
      .manga-card {
        position: relative;
        border-radius: var(--radius);
        overflow: hidden;
        cursor: pointer;
        background: var(--bg3);
        transition:
          transform 0.3s,
          box-shadow 0.3s;
        animation: fadeUp 0.4s ease both;
      }
      .manga-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }
      .manga-card img {
        width: 100%;
        aspect-ratio: 2/3;
        object-fit: cover;
        display: block;
        transition: transform 0.4s;
      }
      .manga-card:hover img {
        transform: scale(1.06);
      }
      .manga-card-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 40px 12px 12px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.92));
      }
      .manga-card-title {
        font-size: 13px;
        font-weight: 700;
        line-height: 1.3;
        margin-bottom: 4px;
      }
      .manga-card-meta {
        font-size: 11px;
        color: var(--orange);
        font-weight: 600;
      }
      .manga-card-views {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.5);
        margin-top: 2px;
      }

      /* â”€â”€ Reader modal overlay â”€â”€ */
      .reader-modal {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #0a0a0e;
        flex-direction: column;
      }
      .reader-modal.open {
        display: flex;
      }

      .reader-topbar {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 18px;
        background: var(--bg2);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        flex-shrink: 0;
        flex-wrap: wrap;
      }
      .reader-close {
        background: none;
        border: none;
        color: var(--text);
        font-size: 20px;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 6px;
        transition: background 0.2s;
        flex-shrink: 0;
      }
      .reader-close:hover {
        background: rgba(255, 255, 255, 0.08);
      }
      .reader-manga-title {
        font-size: 14px;
        font-weight: 700;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .reader-ch-nav {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-left: auto;
      }
      .reader-ch-btn {
        padding: 5px 12px;
        background: var(--bg3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: var(--text);
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .reader-ch-btn:hover {
        border-color: var(--orange);
        color: var(--orange);
      }
      .reader-ch-btn:disabled {
        opacity: 0.3;
        cursor: default;
        pointer-events: none;
      }
      .reader-ch-label {
        font-size: 12px;
        color: var(--muted, #888);
        white-space: nowrap;
        text-transform: capitalize;
      }

      .reader-body {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Chapter sidebar inside reader */
      .reader-sidebar {
        width: 240px;
        background: var(--bg2);
        border-right: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
      }
      @media (max-width: 768px) {
        .reader-sidebar {
          display: none;
        }
      }
      .reader-sidebar-title {
        padding: 12px 14px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        color: var(--orange);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        flex-shrink: 0;
      }
      .reader-ch-list {
        overflow-y: auto;
        flex: 1;
        scrollbar-width: thin;
      }
      .reader-ch-item {
        padding: 10px 14px;
        font-size: 12px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        transition: background 0.15s;
        text-transform: capitalize;
      }
      .reader-ch-item:hover {
        background: var(--bg3);
      }
      .reader-ch-item.active {
        background: rgba(255, 107, 0, 0.15);
        color: var(--orange);
        font-weight: 700;
      }

      /* Page area */
      .reader-pages {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 16px;
        gap: 4px;
        scrollbar-width: thin;
      }
      .reader-pages img {
        display: block;
        max-width: 100%;
        width: 800px;
        border-radius: 2px;
      }
      .reader-empty {
        margin: auto;
        text-align: center;
        color: var(--muted, #888);
        font-size: 15px;
        padding: 40px;
      }
      .reader-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 107, 0, 0.2);
        border-top-color: var(--orange);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 60px auto;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Read progress */
      .read-progress {
        position: fixed;
        bottom: 0;
        left: 0;
        height: 3px;
        background: var(--orange);
        transition: width 0.15s;
        z-index: 10000;
        pointer-events: none;
      }

      /* Manga detail panel (shows when card clicked, before reader opens) */
      .manga-detail-bar {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 500;
        background: var(--bg2);
        border-top: 1px solid rgba(255, 107, 0, 0.3);
        padding: 16px 20px;
        gap: 16px;
        align-items: flex-start;
        animation: slideUp 0.3s ease;
      }
      .manga-detail-bar.open {
        display: flex;
      }
      @keyframes slideUp {
        from {
          transform: translateY(100%);
        }
        to {
          transform: translateY(0);
        }
      }
      .manga-detail-cover {
        width: 60px;
        height: 84px;
        object-fit: cover;
        border-radius: 6px;
        flex-shrink: 0;
      }
      .manga-detail-info {
        flex: 1;
      }
      .manga-detail-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 4px;
      }
      .manga-detail-meta {
        font-size: 11px;
        color: var(--muted, #888);
        margin-bottom: 8px;
      }
      .manga-detail-genres {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 10px;
      }
      .manga-detail-genre {
        padding: 2px 8px;
        background: rgba(255, 107, 0, 0.12);
        border: 1px solid rgba(255, 107, 0, 0.3);
        border-radius: 10px;
        font-size: 10px;
        color: var(--orange);
      }
      .manga-detail-actions {
        display: flex;
        gap: 8px;
      }
      .btn-read-now {
        padding: 8px 20px;
        background: var(--orange);
        border: none;
        border-radius: 8px;
        color: #fff;
        font-weight: 700;
        font-size: 13px;
        cursor: pointer;
        transition: opacity 0.2s;
      }
      .btn-read-now:hover {
        opacity: 0.85;
      }
      .btn-detail-close {
        padding: 8px 14px;
        background: var(--bg3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: var(--text);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .btn-detail-close:hover {
        border-color: rgba(255, 255, 255, 0.3);
      }

      /* Search bar above grid */
      .manga-search-row {
        display: flex;
        gap: 10px;
        margin-bottom: 18px;
      }
      .manga-search-row input {
        flex: 1;
        padding: 10px 16px;
        background: var(--bg3);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        color: var(--text);
        font-size: 14px;
        outline: none;
        font-family: inherit;
      }
      .manga-search-row input:focus {
        border-color: var(--orange);
      }
      .manga-search-row button {
        padding: 10px 20px;
        background: var(--orange);
        border: none;
        border-radius: 10px;
        color: #fff;
        font-weight: 700;
        font-size: 13px;
        cursor: pointer;
        transition: opacity 0.2s;
      }
      .manga-search-row button:hover {
        opacity: 0.85;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <a class="nav-brand" href="index.html"><span>ANIME</span>PAGE</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="anime-list.html">Anime List</a></li>
        <li><a href="manga.html" class="active">Manga</a></li>
        <li><a href="community.html">Community</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
      <div class="nav-search">
        <input
          type="text"
          id="navSearch"
          placeholder="Search anime..."
          onkeydown="navSearchGo(event)"
        />
        <button onclick="navSearchGo({ key: 'Enter' })">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <button class="hamburger" onclick="toggleMenu()" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
      <a href="index.html">Home</a>
      <a href="anime-list.html">Anime List</a>
      <a href="manga.html" class="active">Manga</a>
      <a href="community.html">Community</a>
      <a href="about.html">About</a>
    </div>

    <div class="page">
      <div class="list-page">
        <div class="section-header" style="margin-bottom: 16px">
          <div class="section-title">ğŸ“š Manga</div>
        </div>

        <!-- Search -->
        <div class="manga-search-row">
          <input
            type="text"
            id="mangaSearchInput"
            placeholder="Search manga titlesâ€¦"
            onkeydown="if (event.key === 'Enter') doMangaSearch();"
          />
          <button onclick="doMangaSearch()">
            <i class="fas fa-search"></i> Search
          </button>
        </div>

        <!-- Filters -->
        <div class="list-controls">
          <button
            class="filter-pill active"
            onclick="setFilter('newest', this)"
          >
            Newest
          </button>
          <button class="filter-pill" onclick="setFilter('topview', this)">
            Top View
          </button>
          <button
            class="filter-pill"
            onclick="setFilter('newest&state=Completed', this)"
          >
            Completed
          </button>
          <button
            class="filter-pill"
            onclick="setFilter('newest&state=Ongoing', this)"
          >
            Ongoing
          </button>
        </div>

        <div class="anime-grid" id="mangaGrid"></div>

        <div class="load-more-wrap">
          <button
            class="load-more-btn"
            id="mangaLoadBtn"
            onclick="loadMoreManga()"
          >
            <i class="fas fa-plus"></i> Load More
          </button>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-brand"><span>ANIME</span>PAGE</div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="anime-list.html">Anime List</a>
        <a href="manga.html">Manga</a>
        <a href="community.html">Community</a>
        <a href="about.html">About</a>
      </div>
      <div class="footer-cr">Â© 2024 AnimePage. All rights reserved.</div>
    </footer>

    <!-- â”€â”€ Manga detail bottom sheet â”€â”€ -->
    <div class="manga-detail-bar" id="detailBar">
      <img class="manga-detail-cover" id="detailCover" src="" alt="" />
      <div class="manga-detail-info">
        <div class="manga-detail-title" id="detailTitle"></div>
        <div class="manga-detail-meta" id="detailMeta"></div>
        <div class="manga-detail-genres" id="detailGenres"></div>
        <div class="manga-detail-actions">
          <button class="btn-read-now" onclick="openReader()">
            ğŸ“– Read Now
          </button>
          <button class="btn-detail-close" onclick="closeDetail()">
            âœ• Close
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Full-screen reader modal â”€â”€ -->
    <div class="reader-modal" id="readerModal">
      <div class="reader-topbar">
        <button
          class="reader-close"
          onclick="closeReader()"
          title="Close reader"
        >
          âœ•
        </button>
        <div class="reader-manga-title" id="readerTitle">â€“</div>
        <div class="reader-ch-nav">
          <button
            class="reader-ch-btn"
            id="prevChBtn"
            onclick="navigateChapter(-1)"
          >
            â€¹ Prev
          </button>
          <span class="reader-ch-label" id="readerChLabel">â€“</span>
          <button
            class="reader-ch-btn"
            id="nextChBtn"
            onclick="navigateChapter(1)"
          >
            Next â€º
          </button>
        </div>
      </div>
      <div class="reader-body">
        <aside class="reader-sidebar">
          <div class="reader-sidebar-title">Chapters</div>
          <div class="reader-ch-list" id="readerChList"></div>
        </aside>
        <div
          class="reader-pages"
          id="readerPages"
          onscroll="updateReadProgress()"
        >
          <div class="reader-empty">Select a chapter to begin reading.</div>
        </div>
      </div>
    </div>

    <div class="read-progress" id="readProgress" style="width: 0"></div>
    <div class="toast" id="toast"></div>

    <script src="index.js"></script>
    <script>
      // â”€â”€ MangaHook API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Self-hosted MangaHook scrapes https://ww6.mangakakalot.tv/
      // Change this to wherever your MangaHook instance is deployed.
      const MANGA_BASE = "http://localhost:3000";

      const MangaHook = {
        async getList(page = 1, type = "newest") {
          const res = await fetch(
            `${MANGA_BASE}/api/mangaList?page=${page}&type=${type}`,
          );
          return res.json(); // { mangaList, metaData }
        },
        async search(query, page = 1) {
          const res = await fetch(
            `${MANGA_BASE}/api/search/${encodeURIComponent(query)}?page=${page}`,
          );
          return res.json(); // { mangaList, metaData }
        },
        async getManga(mangaId) {
          const res = await fetch(
            `${MANGA_BASE}/api/mangaList/${encodeURIComponent(mangaId)}`,
          );
          return res.json(); // { manga, chapterList }
        },
        async getChapter(mangaId, chapterId) {
          const res = await fetch(
            `${MANGA_BASE}/api/mangaList/${encodeURIComponent(mangaId)}/${encodeURIComponent(chapterId)}`,
          );
          return res.json(); // { chapterImages, chapterInfo }
        },
      };

      // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let mangaPage = 1;
      let mangaType = "newest";
      let isSearchMode = false;
      let searchQuery = "";

      let activeMangaId = null;
      let activeMangaTitle = "";
      let allChapters = [];
      let currentChIdx = 0;

      // â”€â”€ Grid helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function buildMangaCard(manga, i) {
        return `
          <div class="manga-card" style="animation-delay:${i * 0.04}s"
               onclick="onCardClick('${manga.id}')">
            <img src="${manga.image || ""}" alt="${manga.title}" loading="lazy"
                 onerror="this.src='https://placehold.co/300x420/1a1a26/888?text=No+Image'"/>
            <div class="manga-card-overlay">
              <div class="manga-card-title">${manga.title}</div>
              <div class="manga-card-meta">${(manga.chapter || "").replace(/-/g, " ")}</div>
              ${manga.view ? `<div class="manga-card-views">ğŸ‘ ${manga.view}</div>` : ""}
            </div>
          </div>`;
      }

      function showGridSkeletons(n = 12) {
        document.getElementById("mangaGrid").innerHTML = Array(n)
          .fill(
            '<div class="skeleton" style="aspect-ratio:2/3;border-radius:14px"></div>',
          )
          .join("");
      }

      // â”€â”€ Load / filter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function setFilter(type, btn) {
        isSearchMode = false;
        mangaType = type;
        mangaPage = 1;
        document
          .querySelectorAll(".filter-pill")
          .forEach((p) => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("mangaGrid").innerHTML = "";
        loadMangaPage();
      }

      async function loadMangaPage() {
        const grid = document.getElementById("mangaGrid");
        const btn = document.getElementById("mangaLoadBtn");
        btn.disabled = true;
        btn.textContent = "Loadingâ€¦";
        if (mangaPage === 1) showGridSkeletons();

        try {
          const { mangaList } = isSearchMode
            ? await MangaHook.search(searchQuery, mangaPage)
            : await MangaHook.getList(mangaPage, mangaType);

          if (mangaPage === 1) grid.innerHTML = "";
          if (!mangaList.length && mangaPage === 1) {
            grid.innerHTML =
              '<p style="color:var(--muted,#888);grid-column:1/-1;padding:20px;">No results found.</p>';
          }
          mangaList.forEach((m, i) =>
            grid.insertAdjacentHTML("beforeend", buildMangaCard(m, i)),
          );
          mangaPage++;
        } catch (e) {
          if (mangaPage === 1) grid.innerHTML = "";
          showToast("Failed to load manga. Is your MangaHook server running?");
        }

        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-plus"></i> Load More';
      }

      function loadMoreManga() {
        loadMangaPage();
      }

      // â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      async function doMangaSearch() {
        const q = document.getElementById("mangaSearchInput").value.trim();
        if (!q) return;
        isSearchMode = true;
        searchQuery = q;
        mangaPage = 1;
        document
          .querySelectorAll(".filter-pill")
          .forEach((p) => p.classList.remove("active"));
        document.getElementById("mangaGrid").innerHTML = "";
        loadMangaPage();
      }

      // â”€â”€ Card click â†’ detail sheet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      async function onCardClick(mangaId) {
        // Show loading state in detail bar
        document.getElementById("detailTitle").textContent = "Loadingâ€¦";
        document.getElementById("detailMeta").textContent = "";
        document.getElementById("detailGenres").innerHTML = "";
        document.getElementById("detailCover").src = "";
        document.getElementById("detailBar").classList.add("open");
        activeMangaId = mangaId;

        try {
          const { manga, chapterList } = await MangaHook.getManga(mangaId);
          allChapters = chapterList || [];
          activeMangaTitle = manga.title || mangaId;

          document.getElementById("detailCover").src = manga.image || "";
          document.getElementById("detailTitle").textContent =
            manga.title || "";
          document.getElementById("detailMeta").textContent = [
            manga.author,
            manga.status,
            `${allChapters.length} chapters`,
          ]
            .filter(Boolean)
            .join(" Â· ");
          document.getElementById("detailGenres").innerHTML = (
            manga.genres || []
          )
            .map((g) => `<span class="manga-detail-genre">${g}</span>`)
            .join("");
        } catch (e) {
          showToast("Failed to load manga details.");
          document.getElementById("detailTitle").textContent = mangaId;
        }
      }

      function closeDetail() {
        document.getElementById("detailBar").classList.remove("open");
      }

      // â”€â”€ Open reader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function openReader() {
        closeDetail();
        if (!allChapters.length) {
          showToast("No chapters found.");
          return;
        }

        document.getElementById("readerModal").classList.add("open");
        document.getElementById("readerTitle").textContent = activeMangaTitle;
        document.body.style.overflow = "hidden";

        // Populate sidebar chapter list
        const list = document.getElementById("readerChList");
        list.innerHTML = allChapters
          .map(
            (ch, i) => `
          <div class="reader-ch-item ${i === 0 ? "active" : ""}"
               id="rch-${i}" onclick="openChapter(${i})">
            ${ch.title || ch.id || `Chapter ${i + 1}`}
          </div>`,
          )
          .join("");

        currentChIdx = 0;
        openChapter(0);
      }

      function closeReader() {
        document.getElementById("readerModal").classList.remove("open");
        document.body.style.overflow = "";
        document.getElementById("readProgress").style.width = "0";
      }

      // â”€â”€ Chapter navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      async function openChapter(index) {
        if (index < 0 || index >= allChapters.length) return;
        currentChIdx = index;
        const ch = allChapters[index];

        // Sidebar active state
        document
          .querySelectorAll(".reader-ch-item")
          .forEach((el, i) => el.classList.toggle("active", i === index));
        document
          .getElementById(`rch-${index}`)
          ?.scrollIntoView({ block: "nearest", behavior: "smooth" });

        // Update nav
        document.getElementById("readerChLabel").textContent =
          ch.title || ch.id || `Chapter ${index + 1}`;
        document.getElementById("prevChBtn").disabled =
          index >= allChapters.length - 1;
        document.getElementById("nextChBtn").disabled = index <= 0;

        // Show spinner
        const pages = document.getElementById("readerPages");
        pages.innerHTML = '<div class="reader-spinner"></div>';
        pages.scrollTop = 0;
        document.getElementById("readProgress").style.width = "0";

        try {
          const { chapterImages } = await MangaHook.getChapter(
            activeMangaId,
            ch.id,
          );
          if (!chapterImages?.length) {
            pages.innerHTML =
              '<div class="reader-empty">No pages found for this chapter.</div>';
            return;
          }
          pages.innerHTML = chapterImages
            .map(
              (url, i) => `
            <img src="${url}" alt="Page ${i + 1}"
                 loading="${i < 3 ? "eager" : "lazy"}"
                 onerror="this.style.opacity='.3';this.title='Page ${i + 1} failed to load'"/>`,
            )
            .join("");
          showToast(
            `ğŸ“– ${ch.title || "Chapter"} â€” ${chapterImages.length} pages`,
          );
        } catch (e) {
          pages.innerHTML = `<div class="reader-empty">Failed to load chapter.<br><small>${e.message}</small></div>`;
        }
      }

      function navigateChapter(dir) {
        // +1 = newer (lower index in array), -1 = older (higher index)
        openChapter(currentChIdx - dir);
      }

      // â”€â”€ Read progress bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function updateReadProgress() {
        const el = document.getElementById("readerPages");
        const pct =
          (el.scrollTop / (el.scrollHeight - el.clientHeight)) * 100 || 0;
        document.getElementById("readProgress").style.width = pct + "%";
      }

      // â”€â”€ Close detail on outside click â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      document.addEventListener("click", (e) => {
        const bar = document.getElementById("detailBar");
        if (
          bar.classList.contains("open") &&
          !bar.contains(e.target) &&
          !e.target.closest(".manga-card")
        ) {
          closeDetail();
        }
      });

      // â”€â”€ Keyboard shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      document.addEventListener("keydown", (e) => {
        if (!document.getElementById("readerModal").classList.contains("open"))
          return;
        if (e.key === "Escape") closeReader();
        if (e.key === "ArrowRight") navigateChapter(1);
        if (e.key === "ArrowLeft") navigateChapter(-1);
      });

      // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      loadMangaPage();
    </script>
  </body>
</html>
